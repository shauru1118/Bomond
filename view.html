<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤</title>
<style>
body {
    background:#0d1117;
    color:#e6edf3;
    font-family:'Segoe UI', sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:2rem;
    text-align:center;
    margin:0;
}
.nav a {color:#79c0ff; margin:0 10px; text-decoration:none; font-weight:bold;}
.nav a:hover{text-decoration:underline;}
.card {
    background:#161b22;
    padding:2rem;
    border-radius:12px;
    box-shadow:0 0 20px rgba(0,0,0,0.4);
    max-width:800px;
    width:100%;
    margin-top:2rem;
}
h2 {margin-bottom:1rem;}
#breadcrumb {margin-bottom:1rem; font-size:0.9rem; color:#8b949e;}
#breadcrumb span{cursor:pointer; color:#79c0ff;}
#breadcrumb span:hover{text-decoration:underline;}
.folder-btn, .file-btn, .back-btn {
    display:block;
    width:60%;
    margin:0.5rem auto;
    padding:0.5rem 1rem;
    border:none;
    border-radius:6px;
    font-size:1rem;
    text-align:center;
    opacity:0;
    transform:translateY(-10px);
    animation:fadeInUp 0.4s forwards;
}
.folder-btn {background:#238636; color:white;}
.folder-btn:hover {background:#2ea043;}
.file-btn {background:#238636; color:white; text-decoration:none;}
.file-btn:hover {background:#2ea043;}
.back-btn {background:#586069; color:white;}
.back-btn:hover {background:#444c56;}
@keyframes fadeInUp {
    to {opacity:1; transform:translateY(0);}
}
</style>
</head>
<body>
<div class="nav">
  <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a> |
  <a href="view.html">–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤</a> |
  <a href="tree.html">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞</a>
</div>

<div class="card">
  <h2>–§–∞–π–ª—ã —Å–µ—Ä–≤–µ—Ä–∞</h2>
  <div id="breadcrumb"></div>
  <div id="folders"></div>
  <div id="files"></div>
</div>

<script>
const API = 'https://bomond.pythonanywhere.com';
let currentPath = '';

async function loadDirectory(path){
    currentPath = path || '';
    renderBreadcrumb();
    try{
        const res = await fetch(`${API}/tree`);
        const data = await res.json();
        let node = data;
        if(currentPath){
            currentPath.split('/').forEach(p=>{
                if(!node.children) return;
                node = node.children.find(c=>c.type==='folder' && c.name===p);
            });
        }
        renderNode(node);
    }catch(e){document.getElementById('folders').textContent='–û—à–∏–±–∫–∞: '+e;}
}

function renderBreadcrumb(){
    const bcDiv = document.getElementById('breadcrumb');
    if(!currentPath){
        bcDiv.innerHTML='<span onclick="loadDirectory()">–ö–æ—Ä–µ–Ω—å</span>';
        return;
    }
    let parts = currentPath.split('/'); let html='';
    let acc='';
    html += `<span onclick="loadDirectory()">–ö–æ—Ä–µ–Ω—å</span> / `;
    parts.forEach((p,i)=>{
        acc=i===0?p:acc+'/'+p;
        html+=`<span onclick="loadDirectory('${acc}')">${p}</span>`;
        if(i<parts.length-1) html+=' / ';
    });
    bcDiv.innerHTML=html;

    // –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    const backBtn = document.createElement('button');
    backBtn.className='back-btn';
    backBtn.textContent='–ù–∞–∑–∞–¥';
    backBtn.onclick = ()=>{
        if(parts.length===1) loadDirectory('');
        else loadDirectory(parts.slice(0,-1).join('/'));
    };
    bcDiv.appendChild(backBtn);
}

function renderNode(node){
    const foldersDiv = document.getElementById('folders');
    const filesDiv = document.getElementById('files');
    foldersDiv.innerHTML=''; filesDiv.innerHTML='';
    if(!node || !node.children) return;

    node.children.forEach((c,i)=>{
        if(c.type==='folder'){
            const btn = document.createElement('button');
            btn.className='folder-btn';
            btn.style.animationDelay = `${0.05*i}s`;
            btn.textContent='üìÅ '+c.name;
            btn.onclick = ()=> loadDirectory(currentPath?currentPath+'/'+c.name:c.name);
            foldersDiv.appendChild(btn);
        }else{
            const a = document.createElement('a');
            a.href=`${API}/files/${currentPath?currentPath+'/'+c.name:c.name}`;
            a.download=c.name;
            a.className='file-btn';
            a.style.animationDelay = `${0.05*i}s`;
            a.textContent='üìÑ '+c.name;
            filesDiv.appendChild(a);
        }
    });
}

loadDirectory('');
</script>
</body>
</html>
